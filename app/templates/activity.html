{% extends "__base_ui__.html" %}

{% from "_macros.html" import get_user_avatar_url, render_tab_bar, render_tab_panel, render_user_mailto_link %}

{% set tabs = [
  ('activity', gettext('Activity')),
  ('connected', gettext('Most Connected')),
  ('complete', gettext('Most Complete')),
  ('progress', gettext('My Profile Progress'))
] %}

{% set active_tab = active_tab|default(tabs[0][0]) %}

{% block content %}

{{ render_tab_bar(tabs, active_tab) }}

<div> <!-- Start of tab panel container -->

{% macro user_link(user) -%}
<strong><a href="{{ url_for('views.get_user', userid=user.id) }}">{{ user.full_name }}</a></strong>
{%- endmacro %}

{% macro user_avatar(user) -%}
<img class="e-user-picture" src="{{ get_user_avatar_url(user) }}" alt="">
{%- endmacro %}

{% call render_tab_panel('activity', active_tab, class='b-activity-feed') %}
  <ul class="e-activity-feed-container">
{% for event in events %}
  <li class="e-feed-item">
  <time datetime="{{ event.created_at }}"></time>
  {% if event.type == 'shared_message' %}
    {{ user_avatar(event.user) }}
    <div class="e-feed-message">
      <p>{{ gettext('%(user)s shared:', user=user_link(event.user)) }}</p>
      <p>{{ event.message }}</p>
      <div class="e-actions">
        {% call render_user_mailto_link(event.user, class="material-icons") %}reply{% endcall %}
      </div>
    </div>
  {% elif event.type == 'user_joined_event' %}
    {{ user_avatar(event.user) }}
    <div class="e-feed-message">
      <p>{{ gettext('%(user)s joined NOI.', user=user_link(event.user)) }}</p>
    </div>
  {% elif event.type == 'connection_event' %}
    <div class="e-feed-message">
      <p>{{ gettext('+%(new)s new connections made in NOI.', new=event.emails.count()) }}</p>
      <p>{{ gettext('+%(total)s connections!', total=event.total_connections) }}</p>
    </div>
  {% else %}
    <div class="e-feed-message">
      UNKNOWN EVENT TYPE: {{ event.type }}
    </div>
  {% endif %}
  </li>
{% endfor %}
  </ul>
{% endcall %}

{% call render_tab_panel('connected', active_tab, class='b-activity-feed') %}
<ul class="e-activity-feed-container">
  {% for user, score in most_connected_profiles %}
    <li class="e-feed-item">
      {{ user_avatar(user) }}
      <div class="e-feed-message">
        <p>{{ user_link(user) }}<br>
        {{ gettext('%(score)s Connection(s)', score=score) }}
        </p>
      </div>
      <a href="{{ url_for('views.get_user', userid=user.id) }}" class="material-icons">arrow_forward</a>
    </li>
  {% endfor %}
</ul>
{% endcall %}

{% call render_tab_panel('complete', active_tab) %}
<ol>
  {% for user, score in most_complete_profiles %}
    <li>
      <p>{{ user_link(user) }}</p>
      <small>
        {{ score }} /
        {{ gettext('%(skill)s Skills', skill=QUESTIONS_BY_ID.keys()|length) }}
      </small>
    </li>
  {% endfor %}
</ol>
{% endcall %}

{% call render_tab_panel('progress', active_tab, class='b-profile-progress') %}

{% include "_profile-progress.html" %}

{% endcall %}

</div> <!-- End of tab panel container -->

{% endblock %}
